<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="plco.js"></script>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .tabsRadio:checked+.tabsLabel  {
            font-weight: bolder;
            color: #6EE7B7;
            border-bottom: 4px solid #6EE7B7;
        }

        .tabsRadio:checked+.tabsLabel+.tabsContent  {
            display: initial;
        }

        .plotHoverDivs {
            top: 800px;
            left: 500px;
        }

        .loader {
            border: 16px solid #3498db;
            border-top: 16px solid #3498db;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            position: absolute;
            z-index: 10;
            top: 800px;
            left: 50%;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        
    </style>
    <title>PLCO SDK Explorer</title>
</head>

<body class="divide-y-2 divide-gray-200" onload="plco.explorePhenotypes(false, false, true, 'explorePhenotypes');">
    <header class="bg-gradient-to-b from-white">
        <div class="text-2xl flex flex-row items-center justify-start ">
            <span class="text-3xl md:text-5xl font-extrabold m-4 text-red-900 flex-shrink-0" style="font-family: fantasy;">PLCO SDK Explorer</span>
            <span class="md:text-lg text-sm text-black">
                [<a href="https://github.com/episphere/plco" target="_blank" class="text-blue-600">code</a>] 
                [<a href="https://observablehq.com/@ericr491/plco-sdk" target="_blank" class="text-blue-600">notebook</a>] 
                [<a href="https://gitter.im/episphere/plco" target="_blank" class="text-blue-600">gitter</a>]
                [<a href="https://dceg.cancer.gov/research/who-we-study/cohorts/prostate-lung-colon-ovary-prospective-study" target="_blank" class="text-blue-600">about</a>]
            </span>
        </div>
        <nav class>
            <ul class="w-full md:flex text-center">
                <li class="md:m-4 my-2 mx-4 md:text-xl text-md font-bold border-black border-2 rounded-3xl hover:bg-green-300"><a href="#" class="block md:p-2 py-2 px-4" onclick="document.getElementById('homeContainer').style = '';document.getElementById('exploreContainer').style = 'display:none';document.getElementById('plotContainer').style = 'display:none;';document.getElementById('otherContainer').style = 'display:none;';">Home</a></li>
                <li class="md:m-4 my-2 mx-4 md:text-xl text-md font-bold border-black border-2 rounded-3xl hover:bg-green-300"><a href="#" class="block md:p-2 py-2 px-4" onclick="document.getElementById('homeContainer').style = 'display:none;';document.getElementById('exploreContainer').style = '';document.getElementById('plotContainer').style = 'display:none;';document.getElementById('otherContainer').style = 'display:none;';">Explore Phenotypes</a></li>
                <li class="md:m-4 my-2 mx-4 md:text-xl text-md font-bold border-black border-2 rounded-3xl hover:bg-green-300"><a href="#" class="block md:p-2 py-2 px-4" onclick="document.getElementById('homeContainer').style = 'display:none;';document.getElementById('exploreContainer').style = 'display:none;';document.getElementById('plotContainer').style = '';document.getElementById('otherContainer').style = 'display:none;';">Explore Plots</a></li>
                <li class="md:m-4 my-2 mx-4 md:text-xl text-md font-bold border-black border-2 rounded-3xl hover:bg-green-300"><a href="#" class="block md:p-2 py-2 px-4" onclick="document.getElementById('homeContainer').style = 'display:none;';document.getElementById('exploreContainer').style = 'display:none;';document.getElementById('plotContainer').style = 'display:none;';document.getElementById('otherContainer').style = '';">Other</a></li>
            </ul>
        </nav>
    </header>

    <div class="bg-white flex flex-col max-w-8xl p-6 mx-10" id='homeContainer'>
        <span>Welcome!</span>
    </div>

    <div class="bg-white flex flex-col max-w-8xl p-6 mx-10" id='exploreContainer' style="display: none;">
        <span class="text-lg md:text-3xl font-semibold text-red-900">Explore all the phenotypes available in the PLCO data ecosystem.</span>
        <span>Lorem ipsum dolor sit amet consectetur adipisicing elit. Autem corporis sunt perferendis natus quibusdam nihil reprehenderit officiis, quasi earum tempora accusamus labore reiciendis obcaecati dolores animi saepe? Cupiditate, doloribus id!</span>
        <div class="flex flex-col items-center md:my-16 my-4 w-auto h-auto" id='explorePhenotypes'></div>
        <div class="flex flex-col items-center w-auto h-auto" id='explorePhenotypestable'></div>
        <span class="text-lg md:text-3xl font-semibold text-red-900">Check if the phenotype has plotting data available.</span>
        <span>Lorem ipsum dolor sit amet consectetur adipisicing elit. Autem corporis sunt perferendis natus quibusdam nihil reprehenderit officiis, quasi earum tempora accusamus labore reiciendis obcaecati dolores animi saepe? Cupiditate, doloribus id!</span>
    </div>

    <div class="bg-white flex flex-col max-w-8xl p-6 mx-10" id='plotContainer' style="display: none;">
        <datalist id='sexValues'>
            <option value='all'>
            <option value='female'>
            <option value='male'>
        </datalist>
        <datalist id='ancestryValues'>
            <option value='african_american'>
            <option value='east_asian'>
            <option value='european'>
        </datalist>
        <form onsubmit="
            let arr = JSON.parse(document.getElementById('textarea1').value);
            let tabsContainer = document.querySelectorAll('.tabsContent')
            let tabsMessages = document.querySelectorAll('.tabsMessage')
            try {
                tabsMessages.forEach(tab => tab.innerHTML = 'Loading...') 
                if (arr.length == 0) {
                    throw new SyntaxError('No inputs were given');
                } else if (arr.length == 1) {
                    const {phenotype_id, sex, ancestry} = arr[0]
                    Promise.all([plco.plot.manhattan('manhattan', phenotype_id, sex, ancestry, 2).catch(e => {tabsMessages[0].innerHTML = e.message;}), plco.plot.qq('qq', phenotype_id, sex, ancestry).catch(e => {tabsMessages[1].innerHTML = e.message;}), plco.plot.pca('pca', phenotype_id, sex, ancestry).catch(e => {tabsMessages[2].innerHTML = e.message;})])
                        .then(_ => {tabsMessages.forEach(tab => {if (tab.innerHTML.includes('Loading...')) tab.innerHTML = ''})})
                }
            } catch(e){
                if (e instanceof SyntaxError) {
                    tabsMessages.forEach(function(tab) {tab.innerHTML = e.message })
                }
            }
            finally {
                return false;
            }">
            <span class="text-lg md:text-3xl font-semibold text-red-900">Construct your stratifications for the plots.</span>
            <textarea id="textarea1" readonly="true" class="block border border-black w-full my-4 text-sm">[ ]</textarea>

            <label for='enterPhenotype' class="block text-lg">Enter Phenotype ID:</label> 
            <input type="number" id='enterPhenotype' class="block border border-black md:w-1/4 w-full">

            <label for='enterSex' class="block text-lg">Enter Sex:</label> 
            <input list="sexValues" type="text" id='enterSex' class="block border border-black md:w-1/4 w-full" pattern="all|female|male">

            <label for='enterAncestry' class="block text-lg">Enter Ancestry:</label> 
            <input list="ancestryValues" type="text" id='enterAncestry' class="block border border-black md:w-1/4 w-full" pattern="african_american|east_asian|european">

            <button class="border-2 border-black rounded-xl p-1 px-2 mt-4 mr-4" onclick="let content = JSON.parse(document.getElementById('textarea1').value); let id = Number.parseInt(document.getElementById('enterPhenotype').value);let sex = (document.getElementById('enterSex').value);let ancestry = (document.getElementById('enterAncestry').value); content.push({phenotype_id: id, sex, ancestry}); document.getElementById('textarea1').value = JSON.stringify(content); return false;">Add</button>
            <button type="reset" class="border-2 border-black rounded-xl p-1 px-2 mt-4 mr-4">Reset</button>
            <button type="submit" class="border-2 border-black rounded-xl p-1 px-2 mt-4 mr-4">Submit</button>
        </form>
        <div class="mt-20 mb-10 subplotsContainer flex flex-wrap max-w-8xl justify-evenly items-stretch">
            <input type="radio" class="tabsRadio hidden" name="plot" id="manhattanPlot" checked>
            <label for="manhattanPlot" class="tabsLabel text-xl cursor-pointer p-5 bg-gray-100 flex-grow text-center rounded-tl-xl">Manhattan Plot</label>
            <div id="manhattan" class="tabsContent order-1 w-full border-b-2 border-gray-400 hidden">
                <span class="tabsMessage">
                    Waiting...
                </span>
            </div>

            <input type="radio" class="tabsRadio hidden" name="plot" id="qqPlot">
            <label for="qqPlot" class="tabsLabel text-xl cursor-pointer p-5 bg-gray-100 flex-grow text-center">QQ Plot</label>
            <div id="qq" class="tabsContent order-1 w-full border-b-2 border-gray-400 hidden">
                <span class="tabsMessage">
                    Waiting...
                </span>
            </div>

            <input type="radio" class="tabsRadio hidden" name="plot" id="pcaPlot">
            <label for="pcaPlot" class="tabsLabel text-xl cursor-pointer p-5 bg-gray-100 flex-grow text-center rounded-tr-xl">PCA Plot</label>
            <div id="pca" class="tabsContent order-1 w-full border-b-2 border-gray-400 hidden">
                <span class="tabsMessage">
                    Waiting...
                </span>
            </div>

        </div>
    </div>

    <div class="bg-white flex flex-col max-w-8xl p-6 mx-10" id='otherContainer' style="display: none;">
        <span class="text-lg md:text-3xl font-semi bold text-red-900">Explore all the phenotypes available in the PLCO data ecosystem.</span>
        <span>Lorem ipsum dolor sit amet consectetur adipisicing elit. Autem corporis sunt perferendis natus quibusdam nihil reprehenderit officiis, quasi earum tempora accusamus labore reiciendis obcaecati dolores animi saepe? Cupiditate, doloribus id!</span>
    </div>

    <footer class="max-w-8xl p-6 mx-10 ">
        <span >
            Credits:
        </span>
    </footer>
</body>
</html>
